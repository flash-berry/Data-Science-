---
title: "Pyshnii_DZ4"
author: "Artem Pyshnii Alexsandrovich"
date: "2025-04-17"
output: html_document
---

Загружаем датасет об оценках пользователей сервиса tripadvisor.
```{r}
library(readr)
df <- read_csv("C:/Users/User/Desktop/Data Science/tripadvisor_review.csv")
```
Описание признаков в датасете:

Userd ID - уникальный идентификатор пользователя.
Category 1 - средний пользовательский отзыв о художественных галереях.
Category 2 - средний пользовательский отзыв о танцевальных клубах.
Category 3 - средний пользовательский отзыв о фреш-барах.
Category 4 - средний пользовательский отзыв о ресторанах.
Category 5 - средний пользовательский отзыв о музеях.
Category 6 - средний пользовательский отзыв о курортах.
Category 7 - средний пользовательский отзыв о парках/местах для пикника.
Category 8 - средний пользовательский отзыв о пляжах.
Category 9 - средний пользовательский отзыв о театрах.
Category 10 - средний пользовательский отзыв о храмах.

Переименуем признаки соответсвенно их описанию.
```{r}
df <- df %>% 
  rename(gallery = `Category 1`, dance_club = `Category 2`,
         fresh_bar = `Category 3`, restaurant = `Category 4`,
         museum = `Category 5`, resort = `Category 6`,
         park = `Category 7`, beach = `Category 8`,
         theatre = `Category 9`, temple = `Category 10`)

glimpse(df)
```
Построим матрицу корреляций
```{r}
library(corrplot)

num_vars <- df %>% select(where(is.numeric))
cor_matrix <- cor(num_vars, use = "complete.obs")
corrplot(
  cor_matrix,
  method = "color",      
  type = "upper",        
  addCoef.col = "black", 
  number.cex = 0.7,      
  tl.col = "black",      
  tl.srt = 45,           
  diag = FALSE           
)
```
Наблюдается сильная отрицательная корреляция между Park и Temple, также Park имеет сильную положительную корреляцию с Fresh_bar и среднюю с Resort.
Museum имеет среднюю положительную корреляцию с Resort.
Признак Temple имеет средние отрицательные корреляции c признаками Fresh_bar и Resort.
Остальные корреляции выражены слабо.

Проведём шкалирование датасета.
```{r}
scaled_data <- scale(df[, c(2:6, 8:10)])
```

Проведём кластеризацию шкалированного датасета на 5 кластеров по заданию.
```{r}
library(NbClust) #много индексов для определения оптимального числа кластеров
library(fpc) #много различных методов кластеризации
library(factoextra) #визуализация кластерного анализа

clus_res <- kmeans(scaled_data, 5)
fviz_cluster(clus_res, scaled_data, stand = FALSE,  geom = "point", ggtheme = theme_bw())
```
```{r}
df$cluster <- as.factor(clus_res$cluster)

cluster_means <- df %>%
  group_by(cluster) %>%
  summarise(across(where(is.numeric), mean)) %>%
  pivot_longer(-cluster, names_to = "variable", values_to = "mean_value")

ggplot(cluster_means, aes(x = variable, y = mean_value, fill = cluster)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Средние значения по кластерам",
    x = "Категория",
    y = "Средний рейтинг",
    fill = "Кластер"
  ) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1))  # Наклон подписей
```
**Выводы:** средние оценки по таким локациям как Beach и Park одинаково высоко оцениваются пользователями независимо от выделенного кластера. Другие локации имеют явно выраженные высокие средние оценки от одной из групп пользователей, что может указывать на специфические вкусы и предпочтения пользователей из этой группы. 
Так пользователия из *кластера 2* явно выше остальных ценят Dance_club и Restaurant. 
Пользователи из *кластера 5* - Fresh_bar, Museum и Resort.
Пользователи из *кластера 3* низко оценивают Dance_club, но при этом отдают предпочтение к Gallery больше остальных групп.
Пользователи из *кластера 1* выше остальных ценят Theatre.
Пользователи из *кластера 4* имеют самые низкие средние оценки среди всех групп пользователей по локациям Museum, Resort, Restaurant и Theatre.
Пользователи из *кластеров 2 и 5* ниже других оценивают Temple. 

```{r}

df_long <- df %>%
  select(-`User ID`) %>%  
  pivot_longer(
    cols = -cluster,
    names_to = "variable",
    values_to = "value"
  )

ggplot(df_long, aes(x = cluster, y = value, fill = cluster)) +
  geom_boxplot() +
  facet_wrap(~ variable, scales = "free_y", ncol = 3) +
  labs(
    title = "Распределение значений по кластерам и категориям",
    x = "Кластер",
    y = "Значение",
    fill = "Кластер"
  ) +
  theme_minimal()
```
График ящик с усами подтверждает выводы сделанные по графику средних значений.

Проверим значимо ли отличаются средние значения для кластеров по признаку Theatre.
```{r}
pairwise.t.test(
  x = df$theatre,      
  g = df$cluster,    
)
```
Среднее значения оценки для локации Theatre в кластере 1 значимо отличается от всех остальных кластеров при любом уровне значимости. **Вывод:** пользователи из кластера 1 высоко (смотрим по графику) ценят локацию Theatre, что значимо отличает их от пользователей из других групп.
Также значимы различия между кластерами 4 и 3, 4 и 5.

Проверим значимо ли отличаются средние значения для кластеров по признаку Museum.
```{r}
pairwise.t.test(
  x = df$museum,      
  g = df$cluster,    
)
```
Среднее значение оценки для локации Museum в кластере 5 значимо отличается от всех кластеров, кроме кластера 2, при любом уровне значимости. Различия между средними оценками для кластеров 5 и 2 незначимы на уровне p-value = 0.05. **Вывод:** пользователи из группы 5 оценивают локацию Museum значимо выше (смотрим по графику), чем пользователи из других групп.
Также кластеры 1 и 2 значимо отличаются от кластеров 3 и 4. 

**Охарактеризуем кластеры в терминах предметной области:**
Разбивая пользователей на кластеры, мы получаем группы пользователей со схожими интересами, таким образом можно выделить их предпочтения: 
Пользователи из *кластера 1* больше предпочитают Theatre и Temple и меньше, чем пользователи из других кластеров, предпочитают Fresh_bar и Gallery.
Пользователи из *кластера 2* явно выше остальних ценят Dance_club и Restaurant.
Пользователи из *кластера 3* больше, чем пользователи из других кластеров, ценят Gallery.
Пользователи из *кластера 4* выше всех оценивают Temple и ниже всех оценивают Theatre, Restaurant, Resort и Museum.
Пользователи из *кластера 5* очень ценят Fresh_bar, а также Museum и Resort.
Также есть всеми обожаемые локации, которые получают одинаково высокие оценки от всех пользователей вне зависимости от кластера - это Park и Beach.